Moon:
  bt_navigator:
    ros__parameters:
      use_sim_time: false
      global_frame: Moon/map
      robot_base_frame: Moon/base_link
      odom_topic: odom
      bt_loop_duration: 10
      default_server_timeout: 20
      transform_tolerance: 1.5
      navigators: [navigate_to_pose, navigate_through_poses]
      navigate_to_pose:
        plugin: nav2_bt_navigator::NavigateToPoseNavigator
      navigate_through_poses:
        plugin: nav2_bt_navigator::NavigateThroughPosesNavigator

  bt_navigator_rclcpp_node:
    ros__parameters:
      use_sim_time: false

  controller_server:
    ros__parameters:
      use_sim_time: false
      controller_frequency: 10.0
      use_stamped_cmd_vel: false
      # cmd_vel remapped to cmd_vel_unstamped in launch file
      
      global_frame: Moon/odom
      robot_base_frame: Moon/base_link
      odom_frame: Moon/odom
      
      min_x_velocity_threshold: 0.01
      min_y_velocity_threshold: 0.01
      min_theta_velocity_threshold: 0.05
      failure_tolerance: 0.3
      progress_checker_plugin: progress_checker
      goal_checker_plugins: [goal_checker]
      controller_plugins: [FollowPath]
      odom_topic: odom
      publish_odom_to_base_tf: false
      costmap_update_timeout: 0.5
      publish_velocity_to_odom_tf: false


      progress_checker:
        plugin: nav2_controller::SimpleProgressChecker
        required_movement_radius: 0.05
        movement_time_allowance: 30.0

      goal_checker:
        plugin: nav2_controller::SimpleGoalChecker
        xy_goal_tolerance: 0.10
        yaw_goal_tolerance: 0.25
        stateful: true

      FollowPath:
        plugin: dwb_core::DWBLocalPlanner
        debug_trajectory_details: false
        publish_evaluation: false
        publish_cost_grid_pc: false
        publish_trajectories: false
        min_vel_x: 0.0
        min_vel_y: 0.0
        max_vel_x: 0.4
        max_vel_y: 0.0
        max_vel_theta: 1.0
        min_speed_xy: 0.0
        max_speed_xy: 0.5
        min_speed_theta: 0.0
        acc_lim_x: 1.0
        acc_lim_y: 0.0
        acc_lim_theta: 3.2
        decel_lim_x: -1.0
        decel_lim_y: 0.0
        decel_lim_theta: -3.2
        vx_samples: 12 
        vy_samples: 1
        vtheta_samples: 12
        sim_time: 1.5
        linear_granularity: 0.1
        angular_granularity: 0.1
        transform_tolerance: 1.5
        xy_goal_tolerance: 0.10
        trans_stopped_velocity: 0.25
        short_circuit_trajectory_evaluation: true
        stateful: true
        critics: [RotateToGoal, Oscillation, BaseObstacle, GoalAlign, PathAlign, PathDist, GoalDist]
        BaseObstacle.scale: 10.0
        PathAlign.scale: 32.0
        PathAlign.forward_point_distance: 0.1
        GoalAlign.scale: 24.0
        GoalAlign.forward_point_distance: 0.1
        PathDist.scale: 32.0
        GoalDist.scale: 12.0
        RotateToGoal.scale: 32.0
        RotateToGoal.slowing_factor: 1.3
        RotateToGoal.lookahead_time: -1.0

  local_costmap:
    local_costmap:
      ros__parameters:
        update_frequency: 8.0
        publish_frequency: 4.0
        global_frame: Moon/odom
        robot_base_frame: Moon/base_link
        use_sim_time: false
        transform_tolerance: 1.5
        rolling_window: true
        width: 6
        height: 6
        resolution: 0.02
        robot_radius: 0.22
        # =========== ADD THESE TWO LINES ===========
        tf_topic: /tf
        tf_static_topic: /tf_static
        # ===========================================
        plugins: [obstacle_layer, inflation_layer]
        obstacle_layer:
          plugin: nav2_costmap_2d::ObstacleLayer
          enabled: true
          observation_sources: scan
          scan:
            topic: scan_new
            sensor_frame: Moon/rplidar_link
            max_obstacle_height: 2.0
            clearing: true
            marking: true
            data_type: LaserScan
            raytrace_max_range: 3.0
            raytrace_min_range: 0.0
            obstacle_max_range: 3.0
            obstacle_min_range: 0.0
        inflation_layer:
          plugin: nav2_costmap_2d::InflationLayer
          cost_scaling_factor: 3.0
          inflation_radius: 0.55
        always_send_full_costmap: true

  global_costmap:
    global_costmap:
      ros__parameters:
        update_frequency: 2.0
        publish_frequency: 2.0
        global_frame: Moon/map
        robot_base_frame: Moon/base_link
        use_sim_time: false
        transform_tolerance: 1.5
        robot_radius: 0.22
        resolution: 0.05
        track_unknown_space: true
        plugins: [static_layer, obstacle_layer, inflation_layer]
        # =========== ADD THESE TWO LINES ===========
        tf_topic: /tf
        tf_static_topic: /tf_static
        # ===========================================
        static_layer:
          plugin: nav2_costmap_2d::StaticLayer
          map_subscribe_transient_local: true
        obstacle_layer:
          plugin: nav2_costmap_2d::ObstacleLayer
          observation_sources: scan
          scan:
            topic: scan_new
            sensor_frame: Moon/rplidar_link
            max_obstacle_height: 2.0
            clearing: true
            marking: true
            data_type: LaserScan
            raytrace_max_range: 12.0
            raytrace_min_range: 0.0
            obstacle_max_range: 10.0
            obstacle_min_range: 0.0
        inflation_layer:
          plugin: nav2_costmap_2d::InflationLayer
          cost_scaling_factor: 3.0
          inflation_radius: 0.55
        always_send_full_costmap: true

  planner_server:
    ros__parameters:
      expected_planner_frequency: 2.0
      use_sim_time: false
      transform_tolerance: 1.5
      planner_plugins: [GridBased]
      GridBased:
        plugin: nav2_navfn_planner::NavfnPlanner
        tolerance: 0.5
        use_astar: false
        allow_unknown: true
        publish_planning_tf: false

  behavior_server:
    ros__parameters:
      use_sim_time: false
      costmap_topic: local_costmap/costmap_raw
      footprint_topic: local_costmap/published_footprint
      cycle_frequency: 5.0
      behavior_plugins: [spin, backup, drive_on_heading, assisted_teleop, wait]
      spin:
        plugin: nav2_behaviors::Spin
      backup:
        plugin: nav2_behaviors::BackUp
      drive_on_heading:
        plugin: nav2_behaviors::DriveOnHeading
      wait:
        plugin: nav2_behaviors::Wait
      assisted_teleop:
        plugin: nav2_behaviors::AssistedTeleop
      global_frame: Moon/odom
      local_frame: Moon/odom
      robot_base_frame: Moon/base_link
      transform_tolerance: 1.5
      simulate_ahead_time: 1.0
      max_rotational_vel: 0.6
      min_rotational_vel: 0.4
      rotational_acc_lim: 3.2

  waypoint_follower:
    ros__parameters:
      use_sim_time: false
      loop_rate: 5
      stop_on_failure: false
      waypoint_task_executor_plugin: wait_at_waypoint
      wait_at_waypoint:
        plugin: nav2_waypoint_follower::WaitAtWaypoint
        enabled: true
        waypoint_pause_duration: 200

  velocity_smoother:
    ros__parameters:
      use_sim_time: false
      use_stamped_vel: false
      cmd_vel_topic: cmd_vel_unstamped
      smoothing_frequency: 5.0
      scale_velocities: false
      feedback: OPEN_LOOP
      max_velocity: [0.4, 0.0, 1.0]
      min_velocity: [-0.4, 0.0, -1.0]
      max_accel: [1.0, 0.0, 3.2]
      max_decel: [-1.0, 0.0, -3.2]
      odom_topic: odom
      odom_duration: 0.1
      deadband_velocity: [0.01, 0.01, 0.1]
      velocity_timeout: 1.0